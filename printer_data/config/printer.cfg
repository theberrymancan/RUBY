#####################################################################
#########################  INCLUDES  ################################
#####################################################################
## Test for Github backup ##
[include mainsail.cfg]
[include fan_tach_monitor.cfg]
[include KAMP_Settings.cfg]

[pause_resume]
[exclude_object]
[firmware_retraction]
[skew_correction]

[virtual_sdcard]
path: /home/alexberryman/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[gcode_arcs]
resolution: 0.1               

[force_move]
enable_force_move: true


#####################################################################
#########################  Kinematics  ##############################
#####################################################################

[printer]
kinematics: corexy
max_velocity: 600
max_accel: 10000
max_z_velocity: 50
max_z_accel: 100
minimum_cruise_ratio: 0.5
square_corner_velocity: 25


#####################################################################
################  MCU (MANTA M8P v2) Config  ########################
#####################################################################

[mcu]
canbus_uuid: 20e9829176f6
canbus_interface: can0


#####################################################################
################  Toolhead (EBB36 v1.2) Config  #####################
#####################################################################

[mcu EBB36]
canbus_uuid: 1c49b2dd7186 

[filament_switch_sensor PRE_EXTRUDER]
switch_pin: ^EBB36: PB6
pause_on_runout: True
insert_gcode:
    M117 Insert Detected
runout_gcode:
    M117 Runout Detected

[filament_switch_sensor POST_EXTRUDER]
switch_pin: ^EBB36: PB5
pause_on_runout: True
insert_gcode:
    M117 Insert Detected
runout_gcode:
    M117 Runout Detected

#####################################################################
##############   MCU Cartographer v3 (ADXL345)   ####################
#####################################################################

[mcu scanner]
canbus_uuid: 3dcd961df308        

[scanner]
mcu: scanner
x_offset: 0
y_offset: 21                         
backlash_comp: 0.00525
sensor: cartographer
sensor_alt: carto
mesh_runs: 2

[adxl345]
cs_pin: scanner: PA3
spi_bus: spi1

[resonance_tester]
accel_chip: adxl345
probe_points:
    175, 175, 20

[axis_twist_compensation]
speed: 50
horizontal_move_z: 10
calibrate_start_x: 10
calibrate_end_x: 340
calibrate_y: 175

[bed_mesh]
zero_reference_position: 175,175
speed: 200
horizontal_move_z: 5
mesh_min: 30, 30
mesh_max: 320, 320
probe_count: 30, 30
algorithm: bicubic


#####################################################################
###################   Temperature Monitoring   ######################
#####################################################################

[temperature_sensor CM5]
sensor_type: temperature_host
min_temp: 0
max_temp: 85

[temperature_sensor MANTA]    
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 85

[temperature_sensor EBB36]
sensor_type: temperature_mcu
sensor_mcu: EBB36
min_temp: 0
max_temp: 85

[temperature_sensor Cartographer]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 100

[temperature_sensor CHAMBER]
sensor_type: Generic 3950
sensor_pin: PB0
min_temp: 0
max_temp: 85


#####################################################################
##########################  Extruder  ###############################
#####################################################################

[extruder]
step_pin: EBB36: PD0
dir_pin: EBB36: PD1
enable_pin: !EBB36: PD2
full_steps_per_rotation: 200
microsteps: 16
gear_ratio: 9:1
rotation_distance: 47.088
nozzle_diameter: 0.400
filament_diameter: 1.750
max_extrude_cross_section: 5
max_extrude_only_distance: 200.00
heater_pin: EBB36: PB13
control: pid
pid_Kp: 24.328
pid_Ki: 1.908
pid_Kd: 77.543
min_temp: -20
max_temp: 350
min_extrude_temp: 170
pressure_advance: 0.05
pressure_advance_smooth_time: 0.040
sensor_type:MAX31865
sensor_pin: EBB36: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2

[tmc2209 extruder]
uart_pin: EBB36: PA15
interpolate: true
run_current: 0.60

[verify_heater extruder]
max_error: 120
check_gain_time: 120
hysteresis: 50
heating_gain: 2


#####################################################################
#############################  X Axis  ##############################
#####################################################################

[stepper_x]
# Front Left stepper motor
step_pin: PE6
dir_pin: !PE5
enable_pin: !PC14
microsteps: 32
rotation_distance: 40
full_steps_per_rotation: 200
endstop_pin: EBB36: PB7
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 80
homing_retract_dist: 5
homing_positive_dir: true

[tmc5160 stepper_x]
cs_pin: PC13
spi_software_sclk_pin: PG8
spi_software_mosi_pin: PG6
spi_software_miso_pin: PG7
driver_TPFD: 0
run_current: 1.5
spi_speed: 3500000
interpolate: True

[stepper_x1]
#Rear Right stepper motor
step_pin: PD4
dir_pin: !PD3
enable_pin: !PD6
microsteps: 32
rotation_distance: 40
full_steps_per_rotation: 200

[tmc5160 stepper_x1]
cs_pin: PD5
spi_software_sclk_pin: PG8
spi_software_mosi_pin: PG6
spi_software_miso_pin: PG7
driver_TPFD: 0
run_current: 1.5
spi_speed: 3500000
interpolate: True


#####################################################################
#############################  Y Axis  ##############################
#####################################################################

[stepper_y]
#Front Right stepper motor
step_pin: PC7
dir_pin: !PC8
enable_pin: !PD2
microsteps: 32
rotation_distance: 40
full_steps_per_rotation: 200
endstop_pin: PF2
position_min: 0
position_endstop: 360
position_max: 360
homing_speed: 80
homing_retract_dist: 5
homing_positive_dir: true

[tmc5160 stepper_y]
cs_pin: PC6
spi_software_sclk_pin: PG8
spi_software_mosi_pin: PG6
spi_software_miso_pin: PG7
driver_TPFD: 0
run_current: 1.5
spi_speed: 3500000
interpolate: True

[stepper_y1]
#Rear Left stepper motor
step_pin: PE2
dir_pin: !PE1
enable_pin: !PE4
microsteps: 32
rotation_distance: 40
full_steps_per_rotation: 200

[tmc5160 stepper_y1]
cs_pin: PE3
spi_software_sclk_pin: PG8
spi_software_mosi_pin: PG6
spi_software_miso_pin: PG7
driver_TPFD: 0
run_current: 1.5
spi_speed: 3500000
interpolate: True


#####################################################################
#############################  Z Axis  ##############################
#####################################################################
#    -------z1------- 
#   |                 |
#   |                 |
#   |                 |
#   |                 |
#   |                 |
#   |                 |
#  z0---   display ---z2
#####################################################################
#####################################################################
#####################################################################

[stepper_z]
step_pin: PB8
dir_pin: !PB7
enable_pin: !PE0
microsteps: 16
rotation_distance: 4
endstop_pin: probe:z_virtual_endstop
position_max: 230
position_min: -10.00
homing_speed: 20
homing_retract_dist: 0
homing_positive_dir: False

#--------------------------------------------------------------------
[tmc2209 stepper_z]
uart_pin: PB9
interpolate: true
run_current: 0.8
hold_current: 0.8

#--------------------------------------------------------------------
[stepper_z1]
step_pin: PB4
dir_pin: !PB3
enable_pin: !PB6
microsteps: 16
rotation_distance: 4

#--------------------------------------------------------------------
[tmc2209 stepper_z1]
uart_pin: PB5
interpolate: true
run_current: 0.8
hold_current: 0.8

#--------------------------------------------------------------------
[stepper_z2]
step_pin: PG13
dir_pin: !PG12
enable_pin: !PG15
microsteps: 16
rotation_distance: 4

#--------------------------------------------------------------------
[tmc2209 stepper_z2]
uart_pin: PG14
interpolate: true
run_current: 0.8
hold_current: 0.8


#####################################################################
########################   Heated Bed   #############################
#####################################################################

[heater_bed]
heater_pin: PA1
sensor_pin: PB1
sensor_type: ATC Semitec 104GT-2
control: pid
pid_kp: 53.467
pid_ki: 0.931
pid_kd: 767.921
min_temp: -20
max_temp: 125
max_power: 1.0

[idle_timeout]
timeout: 3600


#####################################################################
############################  Fans  #################################
#####################################################################

[heater_fan hotend_fan]                       # Delta 2510 5V 3-Wire Axial Fan ASB02505SHA-AY6B
pin: EBB36: PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
tachometer_pin: ^EBB36: PB9
tachometer_poll_interval: 0.00015
fan_speed: 0.8
cycle_time: 0.00003

#--------------------------------------------------------------------

# [temperature_fan electronics_fan]             # 2 Noctua NF- A6x25 5v PWM Fans       
# pin: PA2
# max_power: 1.0
# shutdown_speed: 1.0
# cycle_time: 0.00003
# hardware_pwm: True
# kick_start_time: 0.5
# tachometer_pin: ^PC1
# tachometer_ppr: 2
# tachometer_poll_interval: 0.005
# sensor_type: temperature_combined
# sensor_list: temperature_sensor MANTA, temperature_sensor CM5
# combination_method: max
# maximum_deviation: 999.9
# max_temp: 85
# min_temp: 0
# target_temp: 40.0
# max_speed: 1.0
# min_speed: 0.5
# control: watermark
# max_delta: 5
# min_temp: 0
# max_temp: 85
# target_temp: 40.0

[temperature_fan electronics_fan]             # 2 GDSTime GDA6020 24v Dual Ball Bearing Fans       
pin: PF9
max_power: 1.0
shutdown_speed: 1.0
cycle_time: 0.00003
hardware_pwm: False
kick_start_time: 0.5
sensor_type: temperature_combined
sensor_list: temperature_sensor MANTA, temperature_sensor CM5
combination_method: max
maximum_deviation: 999.9
max_temp: 85
min_temp: 0
target_temp: 40.0
max_speed: 1.0
min_speed: 1.0
control: watermark
max_delta: 5
min_temp: 0
max_temp: 85
target_temp: 40.0

#--------------------------------------------------------------------

[controller_fan driver_fan]        # Stepper Driver Cooling - 2 Siboor 24v 4010 Axial Fans
pin: PF6
cycle_time: 0.00003
max_power: 1.0
shutdown_speed: 1.0
fan_speed: 1.0
idle_timeout: 90
idle_speed: 0.4
stepper: stepper_x

#--------------------------------------------------------------------

[fan_generic fan0]                 # 2 GDSTime 24v 4010 12k RPM Part Cooling Fans
pin: EBB36: PA0
max_power: 1.0
shutdown_speed: 0.0
cycle_time: 0.010
hardware_pwm: false
kick_start_time: 0.5
off_below: 0.0

#--------------------------------------------------------------------

[fan_generic fan3]                 # Fume_Pack Exhaust Fan - 2 Siboor 24v 5015 Blower Fans
pin: PF7
cycle_time: 0.00003
hardware_pwm: false
kick_start_time: 0.5

#--------------------------------------------------------------------

[fan_generic BED_FANS]             # 4 GDSTime 24v 5015 Blower Fans
pin: PF8
max_power: 1.0
shutdown_speed: 0
cycle_time: 0.010
hardware_pwm: false
kick_start_time: 0.1

#--------------------------------------------------------------------

[gcode_macro M106]
gcode:
    {% set fan = 'fan' + (params.P|int if params.P is defined else 0)|string %}
    {% set speed = (params.S|float / 255 if params.S is defined else 1.0) %}
    SET_FAN_SPEED FAN={fan} SPEED={speed}
    

#####################################################################
############################  LEDs  #################################
#####################################################################

[neopixel hotend_led]
pin: EBB36: PD3               # LED pin
chain_count: 3                # Number of LEDs
color_order: GRB              # Color order
initial_RED: 1.0              # Initial red brightness
initial_GREEN: 0.1            # Initial green brightness
initial_BLUE: 0.0             # Initial blue brightness


#######################################################################
######################  Homing Override  ##############################
#######################################################################

[homing_override]
axes: xyz                   # Override homing for all axes
set_position_z: 0           # Set the Z position to 0 after homing
gcode:
    G90                     # Set to absolute positioning mode
    G0 Z10 F1200            # Move Z axis to 10mm above the bed at 1200 mm/min
    G28 X                   # Home X axis
    G1 X250 F7200           # Move X to clear rear motor before homing
    G28 Y                   # Home Y axis
    G1 X175 Y175 F7200      # Move to a specific coordinate (175, 175) at 7200 mm/min
    G28 Z                   # Home Z axis again
    

#######################################################################
######################  Z Tilt Adjustment  ############################
#######################################################################

[z_tilt]
##  Use Z_TILT_ADJUST to level the bed.
##  z_positions: Location of toolhead
z_positions:
   -50, 18
   175, 398
   400, 18
points:
   50, 50
   175, 300
   300, 50

#---------------------------------------------------------------------

speed: 350                 # Speed of Z tilt adjustment
horizontal_move_z: 2       # Z axis move speed for adjustments
retries: 10                # Number of retries for adjustment points
retry_tolerance: 0.0075    # Retry tolerance for adjustment accuracy

#---------------------------------------------------------------------

[gcode_macro Z_TILT_ADJUST]     # IDM/Cartographer optimized 3Z leveling macro
rename_existing: _Z_TILT_ADJUST
gcode:
    SAVE_GCODE_STATE NAME=STATE_Z_TILT         # Save current state for Z tilt adjustment
    BED_MESH_CLEAR                             # Clear bed mesh
    {% if not printer.z_tilt.applied %}
      _Z_TILT_ADJUST horizontal_move_z=10 retry_tolerance=1   # Adjust Z tilt with higher tolerance initially
    {% endif %}
    _Z_TILT_ADJUST horizontal_move_z=2          # Fine-tune Z tilt adjustment
    RESTORE_GCODE_STATE NAME=STATE_Z_TILT       # Restore saved state after adjustment
    CENTER                                      # Move toolhead to center of build plate.


#######################################################################
######################  Convenience Macros  ###########################
#######################################################################

[gcode_macro LOAD_FILAMENT]
variable_extruder_temp: 270
variable_extrude_length: 120
gcode:
  {% if printer.print_stats.state != "printing" %}
    {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(extruder_temp)|int %}
    {% set EXTRUDE_LENGTH = params.EXTRUDE_LENGTH|default(extrude_length)|int %}
    {% set target_nozzle_temp = printer[printer.toolhead.extruder].target %}
    {% if target_nozzle_temp < EXTRUDER_TEMP %}
      M109 S{EXTRUDER_TEMP}
    {% endif %}
    M83
    G1 E{EXTRUDE_LENGTH} F180
    M400

    # turn off extruder to help it avoid overheating
    SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
    {% if target_nozzle_temp != EXTRUDER_TEMP %}
      M104 S{target_nozzle_temp}
    {% endif %}
  {% else %}
    RESPOND TYPE=error MSG='Not available while printing'
  {% endif %}

[gcode_macro UNLOAD_FILAMENT]
variable_extruder_temp: 230
gcode:
  {% if printer.print_stats.state != "printing" %}
    {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(extruder_temp)|int %}
    {% set target_nozzle_temp = printer[printer.toolhead.extruder].target %}
    {% if target_nozzle_temp < EXTRUDER_TEMP %}
      M109 S{EXTRUDER_TEMP}
    {% endif %}
    M83
    G1 E20 F180
    G1 E-50 F180
    G1 E-30 F2000
    M400

    # turn off extruder to help it avoid overheating
    SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
    {% if target_nozzle_temp != EXTRUDER_TEMP %}
      M104 S{target_nozzle_temp}
    {% endif %}
  {% else %}
    RESPOND TYPE=error MSG='Not available while printing'
  {% endif %}

[gcode_macro PID_CALIBRATE_HOTEND]
description: Hotend Pid Calibrate
gcode:
  {% if printer.print_stats.state != "printing" %}
    PID_CALIBRATE HEATER=extruder TARGET={params.HOTEND_TEMP|default(230)}
  {% else %}
    RESPOND TYPE=error MSG='Not available while printing'
  {% endif %}

[gcode_macro PID_CALIBRATE_BED]
description: Bed Pid Calibrate
gcode:
  {% if printer.print_stats.state != "printing" %}
    PID_CALIBRATE HEATER=heater_bed TARGET={params.BED_TEMP|default(65)}
  {% else %}
    RESPOND TYPE=error MSG='Not available while printing'
  {% endif %}

[gcode_macro CENTER]
description: Defines a G-code macro for centering the toolhead.
gcode:
    G90                          # Set absolute positioning.
    G0 X175 Y175 Z30 F3600       # Fast move to center position 30mm above bed.

# [gcode_macro NOZZLE_BRUSH]
# gcode:
#    SAVE_GCODE_STATE NAME=nozzle_brush
#    G90
#    G1 X34 F18000
#    G1 X80 F18000
#    G1 Y357 F18000
#    G1 X34 F18000
#    G1 X80 F18000
#    RESTORE_GCODE_STATE NAME=nozzle_brush

[gcode_macro update_git]
gcode:
    {% set message = params.MESSAGE|default() %}
    {% if message %}
        RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
    {% else %}
        RUN_SHELL_COMMAND CMD=update_git_script
    {% endif %}

[gcode_shell_command update_git_script]
command: bash -c "bash $HOME/klipper-backup/script.sh"
timeout: 90.0
verbose: True

[gcode_shell_command update_git_script_message]
command: bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout: 90.0
verbose: True
    

#######################################################################
###################  Probe Calibration Macro  #########################
#######################################################################

[gcode_macro PROBE_CALIBRATE]
# Defines a G-code macro for probe calibration
gcode:
    G28                          # Home all axes
    G0 X175 Y175 Z1 F3600        # Fast move to X150 Y150 Z1 at 3600 mm/min
    PROBE_CALIBRATE              # Start probe calibration
    

#######################################################################
###########  Bed Leveling Height and Calibration Macro  ###############
#######################################################################

[gcode_macro G32]
# Defines a G-code macro for bed leveling and height calibration
gcode:
    BED_MESH_CLEAR               # Clear bed mesh
    G28                          # Home all axes
    Z_TILT_ADJUST                # Perform gantry leveling
    G28                          # Home all axes
    G0 X175 Y175 Z30 F3600       # Fast move to center position 30mm above bed

#---------------------------------------------------------------------

[gcode_macro DRAW_LINES]
gcode:
    G90                           # Absolute positioning
    # G92 E0                      # Reset Extruder (commented out for now)
    # G1 Z5.0  F7200              # Move Z Axis up (commented out for now)
    G1 X50  Y0         F7200      # Move to start position
    M83                           # Set extruder to relative mode
    G1 E15 F400                   # Extrude filament
    G1 Z0.28 F7200                # Lower Z axis
    G1 X200 Y0   Z0.28 F1200 E17  # Draw the first line
    G1 X200 Y0.4 Z0.28 F2400      # Move to side a little
    G1 X55  Y0.4 Z0.28 F1200 E34  # Draw the second line
    G92 E0                        # Reset Extruder
    G90                           # Return to absolute positioning


#######################################################################
###################  Print Start and End Macros  ######################
#######################################################################

[gcode_macro PRINT_START]
gcode:
  {% set target_bed = params.BED|int %}                         # Target bed temperature
  {% set target_extruder = params.EXTRUDER|int %}               # Target nozzle temperature
  {% set x_wait = printer.toolhead.axis_maximum.x|float / 2 %}  # Bed center X
  {% set y_wait = printer.toolhead.axis_maximum.y|float / 2 %}  # Bed center Y

  M104 S150                                                     # Preheat nozzle to 150C to avoid oozing before z-offset adjustment

  SET_GCODE_OFFSET Z=0                                          # Reset Z offset
  G28                                                           # Home all axes
  G90                                                           # Set to absolute positioning

  SET_DISPLAY_TEXT MSG="Heating Bed: {target_bed}°C"            # Display bed heating message
  G1 X{x_wait} Y{y_wait} Z15 F9000                              # Move to bed center
  M190 S{target_bed}                                            # Wait for bed to reach target temperature

  SET_DISPLAY_TEXT MSG="Leveling..."                            # Display leveling message
  Z_TILT_ADJUST                                                 # Perform Z tilt adjustment
  G28 Z                                                         # Re-home Z after adjustment

  SET_DISPLAY_TEXT MSG="Bed Mesh Calibration"                   # Display mesh calibration message
  BED_MESH_CALIBRATE                                            # Perform bed mesh calibration (KAMP)

  SET_DISPLAY_TEXT MSG="Calibrating Z Offset"                   # Display Z offset calibration message
  CARTOGRAPHER_TOUCH                                            # Calibrate Z offset

  SMART_PARK                                                    # Parks Toolhead near KAMP Prime Line
  
  SET_DISPLAY_TEXT MSG="Heating Nozzle: {target_extruder}°C"    # Display nozzle heating message
  M109 S{target_extruder}                                       # Heat nozzle to target temperature

  SET_DISPLAY_TEXT MSG="Preparing to Print..."                  # Display preparation message
  LINE_PURGE                                                    # Initiates KAMP Line Purge command

#--------------------------------------------------------------------

[gcode_macro PRINT_END]
gcode:
    {% set th = printer.toolhead %}
    {% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
    {% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
    {% set z_safe = [th.position.z + 15, th.axis_maximum.z]|min %}
    
    SAVE_GCODE_STATE NAME=STATE_PRINT_END

    M400                           ; wait for buffer to clear
    G92 E0                         ; zero the extruder
    G1 E-20.0 F3600                ; retract filament
    
    # TURN_OFF_HEATERS
    SET_HEATER_TEMPERATURE HEATER=extruder TARGET=150            ; sets heaters to idle position to maintain chamber temperature
    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=110          ; sets heaters to idle position to maintain chamber temperature
    
    G90                                      ; absolute positioning
    G0 X{x_safe} Y{y_safe} Z{z_safe} F20000  ; move nozzle to remove stringing
    G0 X230 Y330 F3600                       ; move toolhead to safe parking spot to avoid collisions when homing next print
    
    M107                                     ; initiate fan control
    SET_FAN_SPEED FAN=BED_FANS SPEED=0.2     ; set bed fans to 20%
    SET_FAN_SPEED FAN=fan3 SPEED=0.2         ; set filter fan to 20%
    SET_FAN_SPEED FAN=fan0 SPEED=0.0         ; set part cooling fans to 0%

    
    BED_MESH_CLEAR

    # The purpose of the SAVE_GCODE_STATE/RESTORE_GCODE_STATE
    # command pair is to restore the printer's coordinate system
    # and speed settings since the commands above change them.
    # However, to prevent any accidental, unintentional toolhead
    # moves when restoring the state, explicitly set MOVE=0.
    RESTORE_GCODE_STATE NAME=STATE_PRINT_END MOVE=0
    
    
#######################################################################
###################  Pause/Resume/Cancel Macros  ######################
#######################################################################

[gcode_macro PAUSE]
rename_existing: BASE_PAUSE
gcode:
    # Parameters
    {% set z = params.Z|default(10)|int %}                                                   ; z hop amount

    {% if printer['pause_resume'].is_paused|int == 0 %}
        SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}                              ; set z hop variable for reference in resume macro
        SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}    ; set hotend temp variable for reference in resume macro

        SET_FILAMENT_SENSOR SENSOR=PRE_EXTRUDER ENABLE=0                                     ; disable filament sensor
        SAVE_GCODE_STATE NAME=PAUSE                                                          ; save current print position for resume
        BASE_PAUSE                                                                           ; pause print
        {% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}       ; check that zhop doesn't exceed z max
            G91                                                                              ; relative positioning
            G1 Z{z} F900                                                                     ; raise Z up by z hop amount
        {% else %}
            { action_respond_info("Pause zhop exceeds maximum Z height.") }                  ; if z max is exceeded, show message and set zhop value for resume to 0
            SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
        {% endif %}
        G90                                                                                  ; absolute positioning
        G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000   ; park toolhead at front center
        SAVE_GCODE_STATE NAME=PAUSEPARK                                                      ; save parked position in case toolhead is moved during the pause (otherwise the return zhop can error)
        M104 S0                                                                              ; turn off hotend
        SET_IDLE_TIMEOUT TIMEOUT=43200                                                       ; set timeout to 12 hours
    {% endif %}

#--------------------------------------------------------------------

[gcode_macro RESUME]
rename_existing: BASE_RESUME
variable_zhop: 0
variable_etemp: 0
gcode:
    # Parameters
    {% set e = params.E|default(2.5)|int %}                                          ; hotend prime amount (in mm)

    {% if printer['pause_resume'].is_paused|int == 1 %}
        SET_FILAMENT_SENSOR SENSOR=PRE_EXTRUDER ENABLE=1                             ; enable filament sensor
        SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}  ; set timeout back to configured value
        {% if etemp > 0 %}
            M109 S{etemp|int}                                                        ; wait for hotend to heat back up
        {% endif %}
        RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100                     ; go back to parked position in case toolhead was moved during pause (otherwise the return zhop can error)
        G91                                                                          ; relative positioning
        M83                                                                          ; relative extruder positioning
        {% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
            G1 Z{zhop * -1} E{e} F900                                                ; prime nozzle by E, lower Z back down
        {% else %}
            G1 Z{zhop * -1} F900                                                     ; lower Z back down without priming (just in case we are testing the macro with cold hotend)
        {% endif %}
        RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60                          ; restore position
        BASE_RESUME                                                                  ; resume print
    {% endif %}
  
#--------------------------------------------------------------------

[gcode_macro CANCEL_PRINT]
rename_existing: BASE_CANCEL_PRINT
gcode:
    SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout} ; set timeout back to configured value
    CLEAR_PAUSE
    PRINT_END
    BASE_CANCEL_PRINT

#--------------------------------------------------------------------

[gcode_macro DATA_SAMPLE]
gcode:
  G90
  M106 S255
  RESPOND TYPE=command MSG='Waiting for Coil to cool to 40'
  M117 Waiting for Coil to cool to 40
  TEMPERATURE_WAIT SENSOR='temperature_sensor cartographer_coil' MAXIMUM=40
  RESPOND TYPE=command MSG='Starting Phase 1 of 4'
  M117 Starting Phase 1 of 4
  M106 S0
  G28
  G0 Z1
  M104 S250
  M140 S110
  G4 P1000
  CARTOGRAPHER_STREAM FILENAME=data1
  M117 Waiting for Coil to heat to 70
  RESPOND TYPE=command MSG='Waiting for Coil to heat to 70'
  TEMPERATURE_WAIT SENSOR='temperature_sensor cartographer_coil' MINIMUM=55
  CARTOGRAPHER_STREAM FILENAME=data1
  M104 S0
  M140 S0
  M106 S255
  G0 Z80
  RESPOND TYPE=command MSG='Waiting for Coil to cool to 40'
  M117 Waiting for Coil to cool to 40
  TEMPERATURE_WAIT SENSOR='temperature_sensor cartographer_coil' MAXIMUM=40

  M117 Starting Phase 2 of 4
  RESPOND TYPE=command MSG='Starting Phase 2 of 4'
  M106 S0
  G28 Z0
  G0 Z2
  M104 S250
  M140 S110
  G4 P1000
  CARTOGRAPHER_STREAM FILENAME=data2
  M117 Waiting for Coil to heat to 70
  RESPOND TYPE=command MSG='Waiting for Coil to heat to 70'
  TEMPERATURE_WAIT SENSOR='temperature_sensor cartographer_coil' MINIMUM=55
  CARTOGRAPHER_STREAM FILENAME=data2
  M104 S0
  M140 S0
  M106 S255
  G0 Z80
  RESPOND TYPE=command MSG='Waiting for Coil to cool to 40'
  M117 Waiting for Coil to cool to 40
  TEMPERATURE_WAIT SENSOR='temperature_sensor cartographer_coil' MAXIMUM=40

  M117 "Starting Phase 3 of 4"
  RESPOND TYPE=command MSG='Starting Phase 3 of 4'
  M106 S0
  G28 Z0
  G0 Z3
  M104 S250
  M140 S110
  G4 P1000
  CARTOGRAPHER_STREAM FILENAME=data3
  M117 Waiting for Coil to heat to 70
  RESPOND TYPE=command MSG='Waiting for Coil to heat to 70'
  TEMPERATURE_WAIT SENSOR='temperature_sensor cartographer_coil' MINIMUM=55
  CARTOGRAPHER_STREAM FILENAME=data3
  M104 S0
  M140 S0
  M106 S255
  G0 Z80
  M117 Waiting for Coil to cool to 40
  RESPOND TYPE=command MSG='Waiting for Coil to cool to 40'
  TEMPERATURE_WAIT SENSOR='temperature_sensor cartographer_coil' MAXIMUM=40

  M117 "Starting Phase 4 of 4"
  RESPOND TYPE=command MSG='Starting Phase 4 of 4'
  M106 S0
  G28 Z0
  G0 Z5
  M104 S250
  M140 S110
  G4 P1000
  CARTOGRAPHER_STREAM FILENAME=data4
  M117 Waiting for Coil to heat to 70
  RESPOND TYPE=command MSG='Waiting for Coil to heat to 70'
  TEMPERATURE_WAIT SENSOR='temperature_sensor cartographer_coil' MINIMUM=55
  CARTOGRAPHER_STREAM FILENAME=data4
  M104 S0
  M140 S0
  RESPOND TYPE=command MSG='Testing complete, please move files using: mv ~/klipper/data1 ~/klipper/data2 ~/klipper/data3 ~/klipper/data4 ~/cartographer-klipper/'
  M117 "Testing complete, please move files using: mv ~/klipper/data1 ~/klipper/data2 ~/klipper/data3 ~/klipper/data4 ~/cartographer-klipper/"
  RESPOND TYPE=command MSG='Follow the remaining instructions here: https://docs.cartographer3d.com/cartographer-probe/advanced-features/temperature-differential-calibration-beta'
  M117 "Follow the remaining instructions here: https://docs.cartographer3d.com/cartographer-probe/advanced-features/temperature-differential-calibration-beta"


#######################################################################
########################  Speed Test Macro  ###########################
#######################################################################

[gcode_macro TEST_SPEED]
# Home, get position, throw around toolhead, home again.
# If MCU stepper positions (first line in GET_POSITION) are greater than a full step different (your number of microsteps), then skipping occured.
# We only measure to a full step to accomodate for endstop variance.
# Example: TEST_SPEED SPEED=300 ACCEL=5000 ITERATIONS=10

description: Test for max speed and acceleration parameters for the printer. Procedure: Home -> ReadPositionFromMCU -> MovesToolhead@Vel&Accel -> Home -> ReadPositionfromMCU

gcode:
    # Speed
    {% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
    # Iterations
    {% set iterations = params.ITERATIONS|default(5)|int %}
    # Acceleration
    {% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
    # Minimum Cruise Ratio
    {% set min_cruise_ratio = params.MIN_CRUISE_RATIO|default(0.5)|float %}
    # Bounding inset for large pattern (helps prevent slamming the toolhead into the sides after small skips, and helps to account for machines with imperfectly set dimensions)
    {% set bound = params.BOUND|default(20)|int %}
    # Size for small pattern box
    {% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
    
    # Large pattern
        # Max positions, inset by BOUND
        {% set x_min = printer.toolhead.axis_minimum.x %}
        {% if x_min < 0 %}
            {% set x_min = 0 %}
        {% endif %}
    
        {% set y_min = printer.toolhead.axis_minimum.y %}
        {% if y_min < 0 %}
            {% set y_min = 0 %}
        {% endif %}
    
        {% set x_min = x_min + bound %}
        {% set x_max = printer.toolhead.axis_maximum.x - bound %}
        {% set y_min = y_min + bound %}
        {% set y_max = printer.toolhead.axis_maximum.y - bound %}
    
    # Small pattern at center
        # Find X/Y center point
        {% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
        {% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
        
        # Set small pattern box around center point
        {% set x_center_min = x_center - (smallpatternsize/2) %}
        {% set x_center_max = x_center + (smallpatternsize/2) %}
        {% set y_center_min = y_center - (smallpatternsize/2) %}
        {% set y_center_max = y_center + (smallpatternsize/2) %}

    # Save current gcode state (absolute/relative, etc)
    SAVE_GCODE_STATE NAME=TEST_SPEED
    
    # Output parameters to g-code terminal
    { action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
    
    # Home and get position for comparison later:
        M400 # Finish moves - https://github.com/AndrewEllis93/Print-Tuning-Guide/issues/66
        G28
        # QGL if not already QGLd (only if QGL section exists in config)
        {% if printer.configfile.settings.quad_gantry_level %}
            {% if printer.quad_gantry_level.applied == False %}
                QUAD_GANTRY_LEVEL
                G28 Z
            {% endif %}
        {% endif %} 
        # Move 50mm away from max position and home again (to help with hall effect endstop accuracy - https://github.com/AndrewEllis93/Print-Tuning-Guide/issues/24)
        G90
        G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
        M400 # Finish moves - https://github.com/AndrewEllis93/Print-Tuning-Guide/issues/66
        G28 X Y
        G0 X{printer.toolhead.axis_maximum.x-1} Y{printer.toolhead.axis_maximum.y-1} F{30*60}
        G4 P1000 
        GET_POSITION

    # Go to starting position
    G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}

    # Set new limits
    {% if printer.configfile.settings.printer.minimum_cruise_ratio is defined %}
        SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} MINIMUM_CRUISE_RATIO={min_cruise_ratio}
    {% else %}
        SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
    {% endif %}

    {% for i in range(iterations) %}
        # Large pattern diagonals
        G0 X{x_min} Y{y_min} F{speed*60}
        G0 X{x_max} Y{y_max} F{speed*60}
        G0 X{x_min} Y{y_min} F{speed*60}
        G0 X{x_max} Y{y_min} F{speed*60}
        G0 X{x_min} Y{y_max} F{speed*60}
        G0 X{x_max} Y{y_min} F{speed*60}
        
        # Large pattern box
        G0 X{x_min} Y{y_min} F{speed*60}
        G0 X{x_min} Y{y_max} F{speed*60}
        G0 X{x_max} Y{y_max} F{speed*60}
        G0 X{x_max} Y{y_min} F{speed*60}
    
        # Small pattern diagonals
        G0 X{x_center_min} Y{y_center_min} F{speed*60}
        G0 X{x_center_max} Y{y_center_max} F{speed*60}
        G0 X{x_center_min} Y{y_center_min} F{speed*60}
        G0 X{x_center_max} Y{y_center_min} F{speed*60}
        G0 X{x_center_min} Y{y_center_max} F{speed*60}
        G0 X{x_center_max} Y{y_center_min} F{speed*60}
        
        # Small pattern box
        G0 X{x_center_min} Y{y_center_min} F{speed*60}
        G0 X{x_center_min} Y{y_center_max} F{speed*60}
        G0 X{x_center_max} Y{y_center_max} F{speed*60}
        G0 X{x_center_max} Y{y_center_min} F{speed*60}
    {% endfor %}

    # Restore max speed/accel/accel_to_decel to their configured values
    {% if printer.configfile.settings.printer.minimum_cruise_ratio is defined %}
        SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} MINIMUM_CRUISE_RATIO={printer.configfile.settings.printer.minimum_cruise_ratio} 
    {% else %}
        SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
    {% endif %}

    # Re-home and get position again for comparison:
        M400 # Finish moves - https://github.com/AndrewEllis93/Print-Tuning-Guide/issues/66
        G28 # This is a full G28 to fix an issue with CoreXZ - https://github.com/AndrewEllis93/Print-Tuning-Guide/issues/12
        # Go to XY home positions (in case your homing override leaves it elsewhere)
        G90
        G0 X{printer.toolhead.axis_maximum.x-1} Y{printer.toolhead.axis_maximum.y-1} F{30*60}
        G4 P1000 
        GET_POSITION

    # Restore previous gcode state (absolute/relative, etc)
    RESTORE_GCODE_STATE NAME=TEST_SPEED

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 58.243
#*# pid_ki = 3.376
#*# pid_kd = 251.174
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 33.498
#*# pid_ki = 10.151
#*# pid_kd = 27.636
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 2750
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.000
#*#
#*# [scanner model default]
#*# model_coef = 1.6562112489681398,
#*# 	1.7436240568144825,
#*# 	0.7389303651835126,
#*# 	0.5017300714296139,
#*# 	0.049250579726811,
#*# 	-0.17359663515361012,
#*# 	0.743599620728255,
#*# 	-0.08337484775474586,
#*# 	-0.642660197520087,
#*# 	0.4693041807173039
#*# model_domain = 3.1719018857235175e-07,3.3020986222816947e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 25.245939
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.120018, -0.119286, -0.121405, -0.127786, -0.129983, -0.130197, -0.128633, -0.130052, -0.130206, -0.129939, -0.129989, -0.131425, -0.136353, -0.137835, -0.137657, -0.137440, -0.137194, -0.134077, -0.132918, -0.131570, -0.130546, -0.128469, -0.127458, -0.124058, -0.125323, -0.124072, -0.125159, -0.129034, -0.126290, -0.129090
#*# 	-0.084703, -0.084160, -0.088620, -0.093701, -0.097716, -0.099142, -0.097936, -0.102664, -0.103297, -0.104762, -0.107026, -0.109923, -0.113529, -0.115844, -0.116834, -0.116795, -0.116306, -0.115077, -0.115108, -0.113971, -0.112237, -0.108792, -0.105172, -0.105491, -0.103773, -0.106868, -0.107137, -0.107335, -0.110710, -0.106292
#*# 	-0.066473, -0.068414, -0.065083, -0.069161, -0.071289, -0.068883, -0.073117, -0.073905, -0.075362, -0.076172, -0.078658, -0.081526, -0.084554, -0.087057, -0.090276, -0.092065, -0.091931, -0.093293, -0.093205, -0.093346, -0.092047, -0.088949, -0.088633, -0.086284, -0.087104, -0.088197, -0.089844, -0.091191, -0.088588, -0.088814
#*# 	-0.060181, -0.059732, -0.061679, -0.061203, -0.059682, -0.061422, -0.062945, -0.063259, -0.060688, -0.060357, -0.059624, -0.060410, -0.062275, -0.064259, -0.067914, -0.071473, -0.073167, -0.075446, -0.076712, -0.073903, -0.073806, -0.073070, -0.070967, -0.071186, -0.069831, -0.071127, -0.075279, -0.074158, -0.075520, -0.072638
#*# 	-0.045938, -0.050404, -0.047457, -0.050868, -0.050210, -0.052289, -0.059104, -0.057611, -0.056578, -0.055469, -0.053896, -0.054364, -0.055066, -0.056965, -0.058456, -0.060526, -0.061831, -0.062960, -0.061481, -0.059630, -0.056753, -0.054524, -0.053641, -0.052370, -0.054539, -0.056113, -0.057267, -0.058333, -0.057493, -0.058160
#*# 	-0.034074, -0.033582, -0.037916, -0.036880, -0.037500, -0.042361, -0.045522, -0.048684, -0.049222, -0.049614, -0.050574, -0.049831, -0.051531, -0.052655, -0.054340, -0.056210, -0.057878, -0.057681, -0.055141, -0.050958, -0.047932, -0.044168, -0.040693, -0.040237, -0.041496, -0.041627, -0.041218, -0.041400, -0.042914, -0.041789
#*# 	-0.020686, -0.026843, -0.020070, -0.024069, -0.025947, -0.031286, -0.036443, -0.037608, -0.039522, -0.038990, -0.038857, -0.039617, -0.041778, -0.043272, -0.045341, -0.046999, -0.049164, -0.049211, -0.047113, -0.044465, -0.041125, -0.037187, -0.035676, -0.034591, -0.034284, -0.033076, -0.032836, -0.033682, -0.033186, -0.032364
#*# 	-0.010281, -0.008462, -0.013897, -0.010816, -0.014715, -0.023635, -0.025884, -0.027964, -0.028768, -0.029408, -0.029475, -0.028014, -0.031326, -0.032317, -0.033776, -0.033987, -0.035039, -0.035164, -0.034977, -0.030853, -0.028668, -0.027934, -0.026207, -0.026657, -0.025161, -0.029403, -0.028270, -0.028167, -0.029616, -0.026973
#*# 	0.003730, 0.001294, 0.003217, 0.000323, -0.004412, -0.013420, -0.015855, -0.015681, -0.015454, -0.016274, -0.015672, -0.016613, -0.018495, -0.020140, -0.020919, -0.022107, -0.021688, -0.021629, -0.019566, -0.017224, -0.014905, -0.013646, -0.014327, -0.012944, -0.014096, -0.014048, -0.016354, -0.018378, -0.016816, -0.016879
#*# 	0.019288, 0.016436, 0.010606, 0.008561, 0.002019, -0.001905, -0.004464, -0.004312, -0.005623, -0.007564, -0.009079, -0.008270, -0.009621, -0.009601, -0.011138, -0.011288, -0.008530, -0.007371, -0.005063, -0.003152, -0.001111, -0.000848, -0.001326, -0.001610, -0.000796, -0.000982, -0.003172, -0.004973, -0.006921, -0.003625
#*# 	0.025290, 0.021310, 0.020550, 0.013906, 0.006416, 0.001387, -0.001307, 0.000796, -0.000548, -0.001970, -0.003735, -0.004700, -0.005779, -0.006107, -0.007579, -0.007584, -0.008189, -0.005445, -0.001930, 0.001161, 0.002599, 0.003761, 0.003876, 0.004233, 0.003086, 0.002617, 0.000709, -0.001482, -0.001867, 0.001175
#*# 	0.027746, 0.026078, 0.021432, 0.018381, 0.010294, 0.004912, 0.004237, 0.004508, 0.006251, 0.003894, 0.002461, 0.001155, -0.000326, -0.001773, -0.002000, -0.003702, -0.003493, 0.000255, 0.003222, 0.005366, 0.006573, 0.006779, 0.008332, 0.008701, 0.008274, 0.006907, 0.004645, 0.001224, 0.001105, 0.006540
#*# 	0.028498, 0.023607, 0.025504, 0.018934, 0.012207, 0.007966, 0.003874, 0.006102, 0.007092, 0.006918, 0.005507, 0.004115, 0.002768, 0.001186, -0.001108, -0.003095, -0.001505, 0.002581, 0.006941, 0.008986, 0.009865, 0.011422, 0.011472, 0.010527, 0.009418, 0.008495, 0.006539, 0.005121, 0.006255, 0.010557
#*# 	0.027337, 0.025575, 0.018406, 0.015571, 0.008787, 0.002478, 0.000928, 0.001955, 0.005352, 0.004917, 0.004031, 0.001117, -0.001750, -0.002081, -0.004652, -0.006701, -0.004238, 0.000334, 0.003323, 0.004764, 0.005926, 0.007442, 0.009952, 0.006912, 0.006640, 0.006028, 0.004959, 0.003598, 0.004276, 0.008440
#*# 	0.029178, 0.025308, 0.022635, 0.015543, 0.009515, 0.005516, 0.002679, 0.006902, 0.009053, 0.009089, 0.007499, 0.004765, 0.001639, -0.000216, -0.002391, -0.004405, -0.001861, 0.001487, 0.005295, 0.006612, 0.006441, 0.008353, 0.010195, 0.009940, 0.007914, 0.007925, 0.006659, 0.006728, 0.006245, 0.008899
#*# 	0.032061, 0.029340, 0.021401, 0.018272, 0.012402, 0.007220, 0.007126, 0.009376, 0.011762, 0.010723, 0.010154, 0.008212, 0.005055, 0.002298, -0.000215, -0.002413, 0.000364, 0.003472, 0.006784, 0.008651, 0.011179, 0.012675, 0.013331, 0.012460, 0.010278, 0.009821, 0.010271, 0.009970, 0.009402, 0.010965
#*# 	0.035904, 0.028080, 0.024320, 0.019608, 0.014214, 0.010577, 0.009660, 0.011592, 0.012796, 0.014138, 0.013850, 0.012555, 0.007478, 0.005110, 0.002910, 0.002981, 0.002800, 0.004086, 0.005323, 0.006770, 0.008246, 0.010474, 0.011573, 0.011512, 0.010098, 0.010183, 0.009422, 0.010013, 0.008113, 0.010994
#*# 	0.034951, 0.029734, 0.024598, 0.020892, 0.015167, 0.011549, 0.011407, 0.013768, 0.015513, 0.016011, 0.016445, 0.013789, 0.009846, 0.007375, 0.006823, 0.005422, 0.003601, 0.001853, 0.002123, 0.004821, 0.005450, 0.006482, 0.009221, 0.010115, 0.011334, 0.011460, 0.012649, 0.012800, 0.012667, 0.011909
#*# 	0.039437, 0.032565, 0.028179, 0.022992, 0.017443, 0.013831, 0.013594, 0.015477, 0.015821, 0.016107, 0.014832, 0.012625, 0.010073, 0.008022, 0.006647, 0.006704, 0.005311, 0.002573, 0.003638, 0.003882, 0.003747, 0.004656, 0.007085, 0.011384, 0.012963, 0.012914, 0.014614, 0.013222, 0.011655, 0.014201
#*# 	0.036742, 0.030745, 0.023400, 0.020411, 0.013887, 0.008922, 0.010377, 0.010390, 0.012548, 0.011828, 0.011084, 0.010291, 0.008341, 0.007050, 0.005568, 0.004770, 0.003117, 0.001291, 0.002692, 0.003199, 0.003767, 0.002571, 0.005341, 0.009557, 0.013990, 0.013854, 0.015052, 0.014156, 0.015461, 0.013362
#*# 	0.032193, 0.025842, 0.022750, 0.018079, 0.011702, 0.005961, 0.004586, 0.005836, 0.007547, 0.007942, 0.008362, 0.007115, 0.007234, 0.007807, 0.006664, 0.004720, 0.004041, 0.003761, 0.003717, 0.003943, 0.003919, 0.002535, 0.003975, 0.008230, 0.013172, 0.014838, 0.015473, 0.015217, 0.014571, 0.016531
#*# 	0.028758, 0.025783, 0.016847, 0.015433, 0.009652, 0.001655, -0.000069, -0.000775, 0.000797, 0.006024, 0.008521, 0.005306, 0.009127, 0.010588, 0.009794, 0.008278, 0.006697, 0.005953, 0.005615, 0.004947, 0.003744, 0.002587, 0.003237, 0.005413, 0.009379, 0.012242, 0.014318, 0.013337, 0.013738, 0.013768
#*# 	0.022763, 0.016884, 0.014386, 0.010825, 0.004772, -0.001463, -0.004629, -0.004633, -0.003310, -0.000068, 0.003548, 0.003891, 0.005268, 0.007958, 0.008196, 0.006423, 0.005025, 0.005244, 0.003852, 0.002679, 0.000248, -0.000802, -0.000694, 0.000731, 0.003789, 0.006083, 0.006672, 0.006251, 0.005544, 0.007522
#*# 	0.022050, 0.018093, 0.009466, 0.009506, 0.004733, -0.003134, -0.003555, -0.005818, -0.005523, -0.004766, -0.006064, -0.003574, -0.000685, 0.000752, 0.001061, 0.000783, -0.000901, -0.001806, -0.001758, -0.002266, -0.004197, -0.006219, -0.006794, -0.006462, -0.005153, -0.003294, -0.003061, -0.004597, -0.003568, -0.003973
#*# 	0.024733, 0.018578, 0.014722, 0.011435, 0.003603, -0.000453, -0.005462, -0.006434, -0.007010, -0.007297, -0.007574, -0.006073, -0.004099, -0.001838, -0.002751, -0.003089, -0.005744, -0.006202, -0.005572, -0.004850, -0.006624, -0.007701, -0.009147, -0.009856, -0.009164, -0.010077, -0.011566, -0.012194, -0.013483, -0.010357
#*# 	0.008901, 0.006898, 0.001128, 0.000835, -0.003114, -0.009242, -0.011608, -0.014118, -0.013839, -0.014355, -0.015486, -0.015038, -0.013189, -0.011308, -0.010407, -0.011978, -0.013365, -0.013658, -0.012522, -0.013114, -0.013801, -0.015575, -0.016281, -0.018112, -0.019290, -0.019602, -0.019976, -0.022108, -0.022031, -0.017471
#*# 	0.000935, -0.005181, -0.006000, -0.009327, -0.014464, -0.017788, -0.022134, -0.021749, -0.022334, -0.022466, -0.023545, -0.023722, -0.021558, -0.019225, -0.018637, -0.020971, -0.022056, -0.022040, -0.021919, -0.021999, -0.024373, -0.026161, -0.027859, -0.031336, -0.032152, -0.032740, -0.033332, -0.033158, -0.032987, -0.014244
#*# 	-0.013174, -0.017059, -0.020694, -0.022124, -0.027540, -0.033329, -0.033768, -0.033513, -0.032347, -0.033169, -0.032290, -0.032121, -0.031525, -0.029552, -0.030172, -0.032657, -0.032224, -0.030767, -0.031632, -0.033799, -0.035398, -0.038086, -0.041923, -0.043862, -0.046463, -0.045386, -0.044051, -0.045498, -0.033828, -0.005040
#*# 	-0.031899, -0.038121, -0.037319, -0.039585, -0.043261, -0.045681, -0.049161, -0.045942, -0.044103, -0.042580, -0.042861, -0.043766, -0.043392, -0.042501, -0.042698, -0.043454, -0.041218, -0.037999, -0.039449, -0.041139, -0.045658, -0.048690, -0.051096, -0.054390, -0.052751, -0.051882, -0.053052, -0.048599, -0.033823, 0.024950
#*# 	-0.047012, -0.049297, -0.052597, -0.053892, -0.055088, -0.056599, -0.056880, -0.055784, -0.052171, -0.050047, -0.051097, -0.051225, -0.050851, -0.050133, -0.050653, -0.051192, -0.047609, -0.045423, -0.047816, -0.048809, -0.048558, -0.051434, -0.053115, -0.053112, -0.054080, -0.052374, -0.053087, -0.049964, -0.016453, 0.054721
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 320.0
#*# min_y = 30.0
#*# max_y = 320.0
#*#
#*# [axis_twist_compensation]
#*# z_compensations = 0.051634, -0.100013, 0.048379
#*# compensation_start_x = 10.0
#*# compensation_end_x = 340.0
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 89.2
#*# shaper_type_y = mzv
#*# shaper_freq_y = 78.0

[include shell_command.cfg]
